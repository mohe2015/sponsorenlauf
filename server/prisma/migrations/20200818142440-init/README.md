# Migration `20200818142440-init`

This migration has been generated by mohe2015 <Moritz.Hedtke@t-online.de> at 8/18/2020, 4:24:40 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `sponsorenlauf`.`User` (
`id` varchar(191) NOT NULL ,
`name` varchar(191) NOT NULL ,
`password` varchar(191) NOT NULL ,
`role` ENUM('ADMIN', 'TEACHER', 'VIEWER') NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `sponsorenlauf`.`Runner` (
`id` varchar(191) NOT NULL ,
`startNumber` int NOT NULL  AUTO_INCREMENT,
`name` varchar(191) NOT NULL ,
`clazz` varchar(191) NOT NULL ,
`grade` int NOT NULL ,
`roundCount` int NOT NULL DEFAULT 0,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `sponsorenlauf`.`Round` (
`id` varchar(191) NOT NULL ,
`studentId` varchar(191) NOT NULL ,
`createdById` varchar(191) NOT NULL ,
`time` datetime(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `sponsorenlauf`.`UserSession` (
`id` varchar(191) NOT NULL ,
`userId` varchar(191) NOT NULL ,
`validUntil` datetime(3) NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE UNIQUE INDEX `User.name_unique` ON `sponsorenlauf`.`User`(`name`)

CREATE UNIQUE INDEX `Runner.startNumber_unique` ON `sponsorenlauf`.`Runner`(`startNumber`)

CREATE UNIQUE INDEX `Runner.name_unique` ON `sponsorenlauf`.`Runner`(`name`)

ALTER TABLE `sponsorenlauf`.`Round` ADD FOREIGN KEY (`studentId`) REFERENCES `sponsorenlauf`.`Runner`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `sponsorenlauf`.`Round` ADD FOREIGN KEY (`createdById`) REFERENCES `sponsorenlauf`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `sponsorenlauf`.`UserSession` ADD FOREIGN KEY (`userId`) REFERENCES `sponsorenlauf`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200818142440-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,55 @@
+datasource mysql {
+  provider = "mysql"
+  url = "***"
+}
+
+// postgresql://postgres:postgres@localhost:5432/myapp
+// docker run --detach --publish 5432:5432 -e POSTGRES_PASSWORD=postgres --name postgres postgres:10.12
+
+generator prisma_client {
+  provider = "prisma-client-js"
+  previewFeatures = ["transactionApi", "aggregateApi", "connectOrCreate", "distinct", "middlewares"]
+}
+
+enum UserRole {
+  ADMIN
+  TEACHER
+  VIEWER
+}
+
+model User {
+  id              String   @default(cuid()) @id
+  name            String   @unique
+  password        String
+  role            UserRole
+  createdRounds   Round[]
+  currentSessions UserSession[]
+}
+
+model Runner {
+  id          String  @default(cuid()) @id
+  startNumber Int     @unique @default(autoincrement()) // https://github.com/prisma/prisma2/issues/1938 https://github.com/graphql-nexus/nexus-plugin-prisma https://github.com/prisma/prisma2 has a bug autoincrement makes this the primary key
+  name        String  @unique
+  // maybe also password so they can login
+  // then they may be like a user
+  clazz       String
+  grade       Int
+  rounds      Round[]
+  roundCount  Int     @default(0)
+}
+
+model Round {
+  id          String   @default(cuid()) @id
+  student     Runner   @relation(fields: [studentId], references: [id])
+  studentId   String
+  createdBy   User     @relation(fields: [createdById], references: [id])
+  createdById String
+  time        DateTime @default(now())
+}
+
+model UserSession {
+  id         String   @id
+  user       User     @relation(fields: [userId], references: [id])
+  userId     String
+  validUntil DateTime
+}
```


